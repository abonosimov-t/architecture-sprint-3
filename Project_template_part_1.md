# Задание 1. Анализ и планирование

Чтобы составить документ с описанием текущей архитектуры приложения, можно часть информации взять из описания компании условия задания. Это нормально.

### 1. Описание функциональности монолитного приложения

Проект "Smart Home Monolith" представляет собой монолитное приложение для управления отоплением и мониторинга температуры в умном доме. Пользователи
могут удаленно включать/выключать отопление, устанавливать желаемую температуру и просматривать текущую температуру через веб-интерфейс.

**Управление отоплением:**

- Пользователи могут удаленно включать и выключать систему отопления
- Пользователи могут устанавливать целевую температуру для каждой комнаты

**Мониторинг температуры:**

- Пользователи могут в реальном времени отслеживать текущую температуру
- Система позволяет получить общую информацию о системе отопления. 

### 2. Анализ архитектуры монолитного приложения

#### 1. Тип проекта и технологический стек:
* Язык программирования: Java 17
* Фреймворк: Spring Boot 3.3.2
* Тип приложения: Монолитное приложение для управления умным домом
* База данных: PostgreSQL
* Система сборки: Maven >=3.8.1 && <4.0.0

#### 2. Архитектура приложения:
Приложение построено по классической трехслойной архитектуре:
1. Controller Layer:
    * REST API для управления отоплением
    * Обработка HTTP-запросов
    * Валидация входных данных
2. Service Layer:
    * Бизнес-логика управления отоплением
    * Управление состоянием устройств
    * Мониторинг температуры
3. Repository Layer:
    * Взаимодействие с базой данных
    * JPA-сущности
    * Управление данными


#### 3. Основные сущности:
1. HeatingSystem
2. TemperatureSensor

#### 4. Инфраструктура:

1. База данных PostgreSQL
2. Контейнеризация:
    * Docker для упаковки приложения
    * Kubernetes (Minikube) для оркестрации
    * Helm для управления релизами
3. CI/CD

#### 5. Взаимодействие компонентов:
1. API Gateway:
    * Использует Kusk Gateway для маршрутизации запросов
    * REST API для взаимодействия с клиентами
2. Мониторинг:
    * Логирование через SLF4J
    * Тестовое покрытие с использованием JUnit и TestContainers
    
#### 6. Особенности реализации:
* Использование Lombok для уменьшения шаблонного кода
* Swagger/OpenAPI для документации API
* Автоматическое создание схемы БД через Hibernate
* Контейнеризация с использованием multi-stage builds в Docker

### 3. Определение доменов и границы контекстов

1. Домен управления устройствами
    * **Операции**:
        * Включение/выключение устройства
        * Установка температуры
    * **Арегат**: устройство

2. Домен телеметрии
    * **Операции**:
        * Мониторинг температуры
    * **Агрегат**: "сенсор температуры" (temperature sensor)
    
3. Домен управления пользователями
    * **Операции**
        * Регистрация пользователей
        * Авторизация и аутентификация
    * **Агрегат**: пользователь

4. Домен управления сценариями умного дома
    * **Операции**
        * Добавление/изменение сценария
    * **Агрегат**: устройство, сценарий
    
5. Домен сторонних интеграций
    * **Операции**
        * Добавление партенрских экосистем в систему "Тёплый дом"
    * **Агрегат**: партнёрское устройство
    

### **4. Проблемы монолитного решения**

Это монолитное приложение с хорошей структурой и современным стеком технологий, готовое к развертыванию в Kubernetes. На текущем этапе развития бизнеса, пока количество устройств и пользователей в системе невелико, решение может не вызывать проблем, как с точки зрения производительности, так и, пока не требует включения новых доменов, с точки зрения внедрения новой бизнес-логики. Тем не менее по мере роста могут возникнуть следующие проблемы:

* **ухудшение производительности** из-за синхронного характера взаимодействия компонентов по мере роста количества пользователей и устройств
    
* **трудности масштабирования** в случае добавления новых доменов и **невозможность масштабировать отдельные компоненты независимо**
* **технологические ограничения** - система привязана к текущему технологическому стеку (Java + Spring Boot), что ограничивает выбор инструментов при внедрении новой функциональности
* необходимость развертывать всё приложение целиком может привести к **длительному времени сборки и развертывания** и **невозможности быстрого добавления новых компонентов**
* **сложность адаптации отдельных компонентов к нагрузке**
* **единая точка отказа** - отказ одного компонента может привести к отказу всей системы, общая база данных
* **риски безопасности** - риск компрометации всей системы при уязвимости в одном компоненте

Обозначенные проблемы делают переход к микросервисной архитектуре обоснованным решением для дальнейшего развития проекта.

### 5. Визуализация контекста системы — диаграмма С4


[Диаграмма контекста C4](/diagrams/monolith/C4_Context.puml)
![Диаграмма контекста C4](/diagrams/monolith/C4_Context.svg)


# Задание 2. Проектирование микросервисной архитектуры

В этом задании вам нужно предоставить только диаграммы в модели C4. Мы не просим вас отдельно описывать получившиеся микросервисы и то, как вы определили взаимодействия между компонентами To-Be системы. Если вы правильно подготовите диаграммы C4, они и так это покажут.

**Диаграмма контейнеров (Containers)**

[Диаграмма контейнеров C4](/diagrams/microservices/C4_Container.puml)
![Диаграмма контейнеров C4](/diagrams/microservices/C4_Container.svg)

**Диаграмма компонентов (Components)**

[Диаграмма компонетов сервиса управления устройствами умного дома](/diagrams/microservices/C4_Component_Devices.puml)
![Device Management Components](/diagrams/microservices/C4_Component_Devices.svg)

[Диаграмма компонетов сервиса управления пользователями и подписками](/diagrams/microservices/C4_Component_User.puml)
![User Servcie Components](/diagrams/microservices/C4_Component_User.svg)

[Диаграмма компонетов сервиса телеметрии](/diagrams/microservices/C4_Component_Telemetry.puml)
![Telemetry Servcie Components](/diagrams/microservices/C4_Component_Telemetry.svg)

[Диаграмма компонетов сервиса управления сценариями умного дома](/diagrams/microservices/C4_Component_Scenario.puml)
![Scenario Servcie Components](/diagrams/microservices/C4_Component_Scenario.svg)

[Диаграмма компонетов интеграции с партнёрами](/diagrams/microservices/C4_Component_Partners.puml)
![Partner Integration Service](/diagrams/microservices/C4_Component_Partners.svg)


# Задание 3. Разработка ER-диаграммы

(Диаграмма сущностей)[/diagrams/microservices/ER.puml]
![ER](/diagrams/microservices/ER.svg)
